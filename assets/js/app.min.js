"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,t){if(a){if("string"==typeof a)return _arrayLikeToArray(a,t);var e=Object.prototype.toString.call(a).slice(8,-1);return"Object"===e&&a.constructor&&(e=a.constructor.name),"Map"===e||"Set"===e?Array.from(a):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(a,t):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,t){(null==t||t>a.length)&&(t=a.length);for(var e=0,o=new Array(t);e<t;e++)o[e]=a[e];return o}function _classCallCheck(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(a,_toPropertyKey(o.key),o)}}function _createClass(a,t,e){return t&&_defineProperties(a.prototype,t),e&&_defineProperties(a,e),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var t=_toPrimitive(a,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(a,t){if("object"!==_typeof(a)||null===a)return a;var e=a[Symbol.toPrimitive];if(void 0!==e){var o=e.call(a,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(a)}!function(a){var t=function(){function t(){_classCallCheck(this,t),this.setupPromocodesPage(),this.setupPages(),this.setupDatepiker(),this.setupSettings(),this.setupCheckPromocode()}return _createClass(t,[{key:"setupPromocodesPage",value:function(){var t=function(){var t=a("#goit-promocodes-search-input").val();a("#goit-promocodes-search").attr("action","/wp-admin/admin.php?page=goit_promocode&search=".concat(t))};a("#goit-promocodes-search-input").keyup(t),a("#goit-promocodes-search-input").click(t);var e=a(".goit-promocodes__table-tabs > a"),o=a(".goit-promocodes__table-body .not_found"),r=a('.goit-promocodes__table-body > *[data-status="active"]'),n=a('.goit-promocodes__table-body > *[data-status="inactive"]'),s=a(".goit-promocodes__table-body *[data-new-status]");e.click((function(t){t.preventDefault();var s=a(this),i=s.data("status");o.addClass("hidden"),e.removeClass("active"),s.addClass("active"),"all"==i?(r.removeClass("hidden"),n.removeClass("hidden")):"active"==i?(r.removeClass("hidden"),n.addClass("hidden"),0==r.length&&o.removeClass("hidden")):"inactive"==i&&(n.removeClass("hidden"),r.addClass("hidden"),0==n.length&&o.removeClass("hidden"))})),s.click((function(t){t.preventDefault();var e=a(this).data("new-status");e="active"==e?2:1,console.log(a(this).parent().parent().parent()),a(this).parent().parent().parent().addClass("in-progress");var o={type:a(this).data("type"),id:a(this).data("id"),status:e};a.post(goitPluginVars.adminURL,o,(function(a){location.reload()}))}))}},{key:"setupPages",value:function(){var t,e=a(".goit__body"),o=a(".goit__body .selected-products"),r=a(".goit__body #add_promocode"),n=a(".goit__body #update_promocode"),s=a(".goit__body input"),i=a(".goit__body textarea"),d=a(".goit__body input#promocod"),l=a(".goit__body input#count"),c=a(".goit__body input#activete_count_user"),u=a(".goit__body input#products"),p=a(".goit__body select#product"),v=a(".goit__body textarea#conditions"),_=a(".goit__body input#date_start"),g=a(".goit__body input#date_end"),f=a(".goit__body input#manager"),m=a(".goit__body select#status"),y=a(".goit__body input#promocode_limit"),b=a(".goit__body input#amount_surcharge"),C=a(".goit__body select#discount_tariff"),h=a(".goit__body textarea#msg_success"),P=a(".goit__body textarea#msg_not_found"),k=a(".goit__body textarea#msg_data_end"),S=a(".goit__body select#tariff"),T=a(".goit__body #add_tariff"),j=a(".goit__body #selected-tariff .selected-tariff"),w=[];d.on("keyup",(function(){r.attr("disabled","disabled"),d.removeClass("success"),d.removeClass("error"),d.addClass("in-progress"),clearTimeout(t),t=setTimeout(Y,2e3)})),d.on("keydown",(function(){clearTimeout(t)}));var Y=function(){a.ajax({url:goitPluginVars.ajaxurl,type:"POST",dataType:"JSON",data:{action:"check_promocode_name",nonce:goitPluginVars.ajaxNonce,promocod:d.val(),count:l.val()},beforeSend:function(){r.attr("disabled","disabled"),d.removeClass("success"),d.removeClass("error"),d.addClass("in-progress")},success:function(a){d.removeClass("in-progress"),0==a?(d.removeClass("error"),d.addClass("success"),r.attr("disabled",!1)):(d.removeClass("success"),d.addClass("error"),r.attr("disabled","disabled"))}})},x=function(){var t=a(this).val();a(this).attr("value",t)};s.keyup(x),i.keyup(x),p.change((function(){var t=a(this).val();if(""!==p.val()&&p.removeClass("error"),t){var e=[];o.html(t.map((function(a){var t=a.split("&id=")[0],o=a.split("&id=")[1];return e=[].concat(_toConsumableArray(e),[o]),'<a href="'.concat(goitPluginVars.product,"&id=").concat(o,'" target="_blank">').concat(t,"</a>")})).join("")),u.attr("value",e)}})),l.keyup(Y),l.bind("keyup mouseup",Y),r.click((function(t){if(t.preventDefault(),s.removeClass("error"),i.removeClass("error"),""==d.val()&&d.addClass("error"),""==u.val()&&p.addClass("error"),""==_.val()&&_.addClass("error"),""==y.val()&&y.addClass("error"),""==b.val()&&b.addClass("error"),""==l.val()&&l.addClass("error"),""!=d.val()&&""!=u.val()&&""!=_.val()&&""!=y.val()&&""!=b.val()&&""!=l.val()){e.addClass("in-progress"),r.attr("disabled","disabled");var o,n={action:"add_promocodes",nonce:goitPluginVars.ajaxNonce,promocod:d.val().toUpperCase(),activete_count_user:c.val(),product:u.val(),tariff:w,conditions:v.val(),date_start:_.val(),date_end:g.val(),manager:f.val(),status:m.val(),promocode_limit:y.val(),msg_success:h.val(),msg_not_found:P.val(),msg_data_end:k.val(),count:l.val()};o=1==l.val()?"&id=".concat(d.val(),"&action=new_add"):"&group=".concat(d.val(),"&action=new_add"),a.ajax({url:goitPluginVars.ajaxurl,type:"POST",dataType:"JSON",data:n,success:function(a){window.location.replace(goitPluginVars.postURL+o)}})}})),n.click((function(t){if(t.preventDefault(),s.removeClass("error"),i.removeClass("error"),""==d.val()&&d.addClass("error"),""==c.val()&&c.addClass("error"),""==u.val()&&p.addClass("error"),""==_.val()&&_.addClass("error"),""==y.val()&&y.addClass("error"),""==b.val()&&b.addClass("error"),""==l.val()&&l.addClass("error"),""!=d.val()&&""!=c.val()&&""!=u.val()&&""!=_.val()&&""!=y.val()&&""!=b.val()&&""!=l.val()){e.addClass("in-progress"),n.attr("disabled","disabled");var o,r={action:"update_promocode",nonce:goitPluginVars.ajaxNonce,promocod:d.val().toUpperCase(),tariff:w,activete_count_user:c.val(),product:u.val(),conditions:v.val(),date_start:_.val(),date_end:g.val(),status:m.val(),promocode_limit:y.val(),count:l.val(),msg_success:h.val(),msg_not_found:P.val(),msg_data_end:k.val()};o=1==l.val()?"&id=".concat(d.val(),"&action=updated"):"&group=".concat(d.val(),"&action=updated"),a.ajax({url:goitPluginVars.ajaxurl,type:"POST",dataType:"JSON",data:r,success:function(a){window.location.replace(goitPluginVars.postURL+o)}})}})),T.click((function(t){if(t.preventDefault(),"disabled"!=T.attr("disabled")){var e,o,r,n=S.val(),s=b.val(),i=C.val();r="UAH"==i?"₴":"USD"==i?"$":"percent"==i?"%":i,o=1==n?n+" місяць":n>1&&n<5?n+" місяці":n+" місяців",a('.goit__body select#tariff option[value="'.concat(S.val(),'"]')).addClass("hidden"),e='<div class="tariff" style="order: '.concat(n,'">').concat(o," - знижка ").concat(s+r,'<span class="remove" data-value="').concat(n,'"></span>'),e+='<input type="hidden" id="tariff_'.concat(n,'" value="').concat(n,"-").concat(s," ").concat(i,'"/></div>'),w.push([n,s,i]),j.append(e),T.attr("disabled","disabled")}})),S.change((function(){T.attr("disabled",!1)})),j.on("click",".remove",(function(){var t=a(this).data("value");a(this).parent().remove(),a('.goit__body select#tariff option[value="'.concat(t,'"]')).removeClass("hidden"),a(".goit__body select#tariff option:selected").val()==t&&T.attr("disabled",!1)})),C.change(O);var O=function(){"percent"==C.val()?(b.attr("max",100),b.attr("min",1),b.val(1)):(b.attr("max",!1),b.attr("min",1),b.val(1))};O(),b.keyup((function(){"percent"==C.val()&&b.val()>100&&b.val(100)}))}},{key:"setupDatepiker",value:function(){var t=a("#orders_result"),e=a(".goit-statistic__table-body"),o=moment().format("D/M/YYYY"),r=moment().subtract(1,"days").format("D/M/YYYY"),n=moment().subtract(7,"days").format("D/M/YYYY"),s=moment().subtract(30,"days").format("D/M/YYYY");a("#datepicker").daterangepicker({opens:"right",ranges:{"Сьогодні":[o,o],"Вчора":[r,r],"Остані 7 Днів":[n,o],"Остані 30 Днів":[s,o]},alwaysShowCalendars:!0,startDate:n,endDate:o},(function(o,r){console.log("Нова дата фільтрації: "+o.format("D/M/YYYY")+" - "+r.format("D/M/YYYY")),a.ajax({url:goitPluginVars.ajaxurl,type:"POST",dataType:"JSON",data:{action:"statistic_datepicker",nonce:goitPluginVars.ajaxNonce,date_start:o.format("YYYY.M.D"),date_end:r.format("YYYY.M.D")},beforeSend:function(){a(".loader").removeClass("hidden"),t.addClass("is-loading"),e.addClass("is-loading")},success:function(o){a(".loader").addClass("hidden"),t.removeClass("is-loading"),e.removeClass("is-loading"),t.html(o.orders_result),e.html(o.body_result)}})}))}},{key:"setupSettings",value:function(){var t=a("#settings"),e=a("#settings_update"),o=a("#zoho_products_update"),r=a("#rebuild_db"),n=a("#settings input#zoho_client_id"),s=a("#settings input#zoho_client_secret"),i=a("#settings input#zoho_refresh_token"),d=a("#settings input#w4p_token"),l=a("#settings input#products_crm_url");e.click((function(e){e.preventDefault();var o={action:"update_config",nonce:goitPluginVars.ajaxNonce,ZOHO_CLIENT_ID:n.val(),ZOHO_CLIENT_SECRET:s.val(),ZOHO_REFRESH_TOKEN:i.val(),W4P_TOKEN:d.val(),products_crm_URL:l.val()};a.ajax({url:goitPluginVars.ajaxurl,type:"POST",dataType:"JSON",data:o,beforeSend:function(){a(".loader").removeClass("hidden"),t.addClass("is-loading")},success:function(a){a&&setTimeout((function(){window.location.replace(goitPluginVars.settings+"&action=updated")}),3e3)}})})),o.click((function(e){e.preventDefault();var o={action:"sync_crm_products",nonce:goitPluginVars.ajaxNonce};a.ajax({url:goitPluginVars.ajaxurl,type:"POST",dataType:"JSON",data:o,beforeSend:function(){a(".loader").removeClass("hidden"),t.addClass("is-loading")},success:function(a){window.location.replace(goitPluginVars.product)}})})),r.click((function(e){e.preventDefault();var o={action:"rebuild_db",nonce:goitPluginVars.ajaxNonce};a.ajax({url:goitPluginVars.ajaxurl,type:"POST",dataType:"JSON",data:o,beforeSend:function(){a(".loader").removeClass("hidden"),t.addClass("is-loading")},success:function(a){window.location.replace(goitPluginVars.settings+"&action=db")}})}))}},{key:"setupCheckPromocode",value:function(){var t=a("#goit-promocode__input"),e=a("#goit-promocode__activate"),o=a("#goit-promocode__msg"),r=t.data("product");e.click((function(n){n.preventDefault(),o.removeClass("success"),o.removeClass("error"),t.removeClass("error"),""!=t.val().length?a.ajax({url:goitPluginVars.ajaxurl,type:"POST",dataType:"JSON",data:{action:"check_promocode",nonce:goitPluginVars.ajaxNonce,promocode:t.val(),product:r},beforeSend:function(){e.parent().addClass("is-loading")},success:function(a){e.parent().removeClass("is-loading"),a.status?o.addClass("success"):o.addClass("error"),o.html(a.msg)}}):t.addClass("error")}))}}]),t}();window.promocodesAdmin=new t}(window.jQuery);