"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,t){if(a){if("string"==typeof a)return _arrayLikeToArray(a,t);var e=Object.prototype.toString.call(a).slice(8,-1);return"Object"===e&&a.constructor&&(e=a.constructor.name),"Map"===e||"Set"===e?Array.from(a):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(a,t):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,t){(null==t||t>a.length)&&(t=a.length);for(var e=0,o=new Array(t);e<t;e++)o[e]=a[e];return o}function _classCallCheck(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(a,_toPropertyKey(o.key),o)}}function _createClass(a,t,e){return t&&_defineProperties(a.prototype,t),e&&_defineProperties(a,e),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var t=_toPrimitive(a,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(a,t){if("object"!==_typeof(a)||null===a)return a;var e=a[Symbol.toPrimitive];if(void 0!==e){var o=e.call(a,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(a)}!function(a){var t=function(){function t(){_classCallCheck(this,t),this.setupPromocodesPage(),this.setupPages(),this.setupDatepiker()}return _createClass(t,[{key:"setupPromocodesPage",value:function(){var t=function(){var t=a("#goit-promocodes-search-input").val();a("#goit-promocodes-search").attr("action","/wp-admin/admin.php?page=goit_promocode&search=".concat(t))};a("#goit-promocodes-search-input").keyup(t),a("#goit-promocodes-search-input").click(t);var e=a(".goit-promocodes__table-tabs > a"),o=a(".goit-promocodes__table-body .not_found"),r=a('.goit-promocodes__table-body > *[data-status="active"]'),s=a('.goit-promocodes__table-body > *[data-status="inactive"]'),n=a(".goit-promocodes__table-body *[data-new-status]");e.click((function(t){t.preventDefault();var n=a(this),i=n.data("status");o.addClass("hidden"),e.removeClass("active"),n.addClass("active"),"all"==i?(r.removeClass("hidden"),s.removeClass("hidden")):"active"==i?(r.removeClass("hidden"),s.addClass("hidden"),0==r.length&&o.removeClass("hidden")):"inactive"==i&&(s.removeClass("hidden"),r.addClass("hidden"),0==s.length&&o.removeClass("hidden"))})),n.click((function(t){t.preventDefault();var e=a(this).data("new-status");e="active"==e?2:1,console.log(a(this).parent().parent().parent()),a(this).parent().parent().parent().addClass("in-progress");var o={type:a(this).data("type"),id:a(this).data("id"),status:e};a.post(pluginVars.adminURL,o,(function(a){location.reload()}))}))}},{key:"setupPages",value:function(){var t=a(".goit__body"),e=a(".goit__body .selected-products"),o=a(".goit__body #add_promocode"),r=a(".goit__body #update_promocode"),s=a(".goit__body input"),n=a(".goit__body textarea"),i=a(".goit__body input#promocod"),l=a(".goit__body input#count"),d=a(".goit__body input#activete_count_user"),c=a(".goit__body input#products"),u=a(".goit__body select#product"),p=a(".goit__body textarea#conditions"),v=a(".goit__body select#tariff"),_=a(".goit__body input#date_start"),m=a(".goit__body input#date_end"),y=a(".goit__body input#manager"),f=a(".goit__body select#status"),g=a(".goit__body input#promocode_limit"),b=a(".goit__body input#amount_surcharge"),C=a(".goit__body select#discount_tariff"),h=a(".goit__body textarea#msg_success"),k=a(".goit__body textarea#msg_not_found"),w=a(".goit__body textarea#msg_data_end"),Y=function(){var t=a(this).val();a(this).attr("value",t)},S=function(){a.ajax({url:pluginVars.ajaxurl,type:"POST",dataType:"JSON",data:{action:"ajax_check_promocode_name",promocod:i.val(),count:l.val()},beforeSend:function(){o.attr("disabled","disabled"),i.removeClass("success"),i.removeClass("error"),i.addClass("in-progress")},success:function(a){i.removeClass("in-progress"),0==a?(i.removeClass("error"),i.addClass("success"),o.attr("disabled",!1)):(i.removeClass("success"),i.addClass("error"),o.attr("disabled","disabled"))}})};s.keyup(Y),n.keyup(Y),u.change((function(){var t=a(this).val();if(""!==u.val()&&u.removeClass("error"),t){var o=[];e.html(t.map((function(a){var t=a.split("?id=")[0],e=a.split("&name=")[0].split("?id=")[1],r=a.split("&name=")[1];return o=[].concat(_toConsumableArray(o),[e]),'<a href="'.concat(t,'" target="_blank">').concat(r,"</a>")})).join("")),c.attr("value",o)}})),i.keyup(S),l.keyup(S),l.bind("keyup mouseup",S),o.click((function(e){if(e.preventDefault(),s.removeClass("error"),n.removeClass("error"),""==i.val()&&i.addClass("error"),""==d.val()&&d.addClass("error"),""==c.val()&&u.addClass("error"),""==_.val()&&_.addClass("error"),""==g.val()&&g.addClass("error"),""==b.val()&&b.addClass("error"),""==l.val()&&l.addClass("error"),""!=i.val()&&""!=d.val()&&""!=c.val()&&""!=_.val()&&""!=g.val()&&""!=b.val()&&""!=l.val()){t.addClass("in-progress"),o.attr("disabled","disabled");var r,Y={action:"ajax_add_promocodes",promocod:i.val().toUpperCase(),activete_count_user:d.val(),product:c.val(),tariff:v.val(),conditions:p.val(),date_start:_.val(),date_end:m.val(),manager:y.val(),status:f.val(),promocode_limit:g.val(),amount_surcharge:b.val(),discount_tariff:C.val(),msg_success:h.val(),msg_not_found:k.val(),msg_data_end:w.val(),count:l.val()};r=1==l.val()?"&id=".concat(i.val(),"&action=new_add"):"&group=".concat(i.val(),"&action=new_add"),a.ajax({url:pluginVars.ajaxurl,type:"POST",dataType:"JSON",data:Y,success:function(){window.location.replace(pluginVars.postURL+r)}})}})),r.click((function(e){if(e.preventDefault(),s.removeClass("error"),n.removeClass("error"),""==i.val()&&i.addClass("error"),""==d.val()&&d.addClass("error"),""==c.val()&&u.addClass("error"),""==_.val()&&_.addClass("error"),""==g.val()&&g.addClass("error"),""==b.val()&&b.addClass("error"),""==l.val()&&l.addClass("error"),""!=i.val()&&""!=d.val()&&""!=c.val()&&""!=_.val()&&""!=g.val()&&""!=b.val()&&""!=l.val()){t.addClass("in-progress"),r.attr("disabled","disabled");var o,y={action:"ajax_update_promocode",promocod:i.val().toUpperCase(),activete_count_user:d.val(),product:c.val(),tariff:v.val(),conditions:p.val(),date_start:_.val(),date_end:m.val(),promo_status:f.val(),promocode_limit:g.val(),amount_surcharge:b.val(),discount_tariff:C.val(),count:l.val(),msg_success:h.val(),msg_not_found:k.val(),msg_data_end:w.val()};o=1==l.val()?"&id=".concat(i.val(),"&action=updated"):"&group=".concat(i.val(),"&action=updated"),a.ajax({url:pluginVars.ajaxurl,type:"POST",dataType:"JSON",data:y,success:function(a){console.log(a),console.log(pluginVars.postURL+o),window.location.replace(pluginVars.postURL+o)}})}}))}},{key:"setupDatepiker",value:function(){var t=moment().format("D/M/YYYY"),e=moment().subtract(1,"days").format("D/M/YYYY"),o=moment().subtract(7,"days").format("D/M/YYYY"),r=moment().subtract(30,"days").format("D/M/YYYY");a("#datepicker").daterangepicker({opens:"right",ranges:{"Сьогодні":[t,t],"Вчора":[e,e],"Остані 7 Днів":[o,t],"Остані 30 Днів":[r,t]},alwaysShowCalendars:!0,startDate:o,endDate:t},(function(a,t,e){console.log("Нова дата фільтрації: "+a.format("D/M/YYYY")+" - "+t.format("D/M/YYYY"))}))}}]),t}();window.promocodesAdmin=new t}(window.jQuery);